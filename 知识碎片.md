# 端到端测试Cypress

## 案例解析

看一段代码

```bash
#!/bin/bash

# By default we assume that the target for the CI is local
target=local

while :; do
    case $1 in
        -e|--env)
            if [ "$2" ]; then
                target=$2
                shift
            else
                die 'ERROR: "--env" requires a non-empty option argument. Allowed values local/ci'
            fi
            ;;
        --env=?*)
            target=${1#*=} # Delete everything up to "=" and assign the remainder.
            ;;
        *) # Default case: No more options, so break out of the loop.
          break
    esac
    shift
done

echo "Got the target: $target"
if [ "$target" == "ci" ]; then
    # On the CI server run the tests in parallel
    # This requires the projectId and the record_key to be configured in your environment variables. By default this is defined on the CI server
    echo "Got the Build ID: $BUILD_ID"
    yarn cypress run --headless \
    --record --key "$CYPRESS_RECORD_KEY" --ci-build-id $BUILD_ID \
    --parallel --group "Electrons on Gitlab CI" \
    --spec "cypress/integration/Regression_TestSuite/**/*.js"
else
    yarn cypress run --headless --browser chromium --spec "cypress/integration/Regression_TestSuite/**/*.js"
fi

```

解析：

```bash
target=local
```

标识测试环境，默认local；

```bash
while :; do
...
done
```

开启一个无限循环，开始处理命令行参数。

```bash
case $1 in
-e|--env)
    if [ "$2" ]; then
        target=$2
        shift
    else
        die 'ERROR: "--env" requires a non-empty option argument. Allowed values local/ci'
    fi
    ;;
--env=?)
    target=${1#=} # Delete everything up to "=" and assign the remainder.
    ;;
*)
    break
    ;;
esac
```

使用 `case` 语句处理**命令行参数**，检查参数是否是 `-e` 或 `--env`。如果是的话，它会将 `target` 变量设置为命令行参数的下一个值（`$2`）；

如果下一个值**不存在**，则会输出错误消息并**退出**脚本；

如果命令行参数是 `--env=`，则会将 `target` 变量设置为 `=` 后面的值。否则，如果命令行参数不是 `-e` 或 `--env`，则会跳出循环。

```bash
shift
```

将命令行参数向左移动一位，以便读取下一个参数。

```bash
echo "Got the target: $target"
```

输出 `target` 变量的值，以帮助你确认设置是否正确。

```bash
if [ "$target" == "ci" ]; then
    # On the CI server run the tests in parallel
    # This requires the projectId and the record_key to be configured in your environment variables. By default this is defined on the CI server
    echo "Got the Build ID: $BUILD_ID"
    yarn cypress run --headless \
    --record --key "$CYPRESS_RECORD_KEY" --ci-build-id $BUILD_ID \
    --parallel --group "Electrons on Gitlab CI" \
    --spec "cypress/integration/Regression_TestSuite/**/*.js"
else
    yarn cypress run --headless --browser chromium --spec "cypress/integration/Regression_TestSuite/**/*.js"
fi
```

如果target标识是ci，则在ci服务器上运行cypress；

使用 `yarn cypress run` 命令运行 Cypress 测试，并传递一些参数。这些参数包括：

- `--headless`：在无头模式下运行 Cypress 测试。
- `--record`：将测试结果上传到 Cypress Dashboard。
- `--key`：Cypress Dashboard 的记录密钥。
- `--ci-build-id`：CI 构建 ID，用于标识测试结果。
- `--parallel`：在 CI 服务器上并行运行测试。
- `--group`：将测试结果分组。
- `--spec`：指定要运行的测试文件。

如果 `target` 变量的值不是 `ci`，则表示要在本地运行测试，并且只需使用以下参数：

- `--headless`：在无头模式下运行 Cypress 测试。
- `--browser chromium`：指定要使用的浏览器。
- `--spec`：指定要运行的测试文件。

# bash

## 构建镜像和pull到远程仓库

```bash
#!/bin/bash

push_image() {
  # 获取参数
  registry="$1"
  repository="$2"
  password="$3"

  # 获取当前时间戳
  timestamp=$(date '+%Y%m%d%H%M%S')

  # 构建 Docker 镜像
  docker build -t "$registry/$repository:$timestamp" .
  if [ $? -eq 0 ]; then
    echo "Docker 镜像构建成功！"
  else
    echo "Docker 镜像构建失败！"
    exit 1
  fi

  # 登录到 Harbor 仓库
  echo "$password" | docker login -u admin --password-stdin "$registry"
  if [ $? -eq 0 ]; then
    echo "登录 Harbor 仓库成功！"
  else
    echo "登录 Harbor 仓库失败！"
    exit 1
  fi

  # 推送镜像到 Harbor 仓库
  docker push "$registry/$repository:$timestamp"
  if [ $? -eq 0 ]; then
    echo "镜像推送成功！"
  else
    echo "镜像推送失败！"
    exit 1
  fi
}

# 获取用户输入
read -p "请输入 Harbor 仓库地址： " registry
read -p "请输入镜像仓库名称： " repository
read -p "请输入登录密码： " password

echo # 换行

# 调用函数，并传递用户输入的参数
push_image "$registry" "$repository" "$password"

```



# linux

## 查看端口进程

1.netstat

```
netstat -tuln | grep 7777
```

这将显示所有正在监听（LISTEN）该端口的进程以及相关的详细信息。

- `-t`：只显示 TCP 协议相关的连接信息。
- `-u`：只显示 UDP 协议相关的连接信息。
- `-l`：只显示正在监听（LISTEN）的连接信息。
- `-n`：以数字形式显示 IP 地址和端口号，而不进行反向解析。
- `-a`：显示所有连接，包括正在监听（LISTEN）和已建立的连接。
- `-p`：显示与连接关联的进程/程序的PID和名称。
- `-s`：显示统计信息，如接收和发送的数据包数量。
- `-r`：显示路由表信息。
- `-c`：连续输出，持续显示连接信息。

**例子**

执行 `netstat -aln | grep 7777`

输出

```
tcp  0 0 0.0.0.0:7777 0.0.0.0:* LISTEN
tcp6 0 0 :::7777      :::*      LISTEN
```

输出结果说明了以下情况：

1. 第一行输出显示了一个 TCP 连接，它正在监听（LISTEN）0.0.0.0:7777 这个地址。这表示该主机上的所有**网络接口**都可以通过 **TCP 协议**连接到端口 7777。IP 地址 0.0.0.0 是一个通配符，表示所有可用的网络接口。
2. 第二行输出显示了一个 **TCP6** 连接，它也在监听（LISTEN）端口 7777。`:::` 是 IPv6 的通配符地址，表示所有可用的 IPv6 网络接口。

综上所述，这两行输出表明有两个不同的监听连接，一个是通过 IPv4（tcp） 监听 0.0.0.0:7777，另一个是通过 IPv6（tcp6） 监听 :::7777。这意味着有一个正在运行的进程在这两个地址上监听 7777 端口，等待来自**其他计算机**的连接。

2.lsof

```
lsof -i :7777
```

这将列出正在使用该指定端口的进程信息，包括进程ID（PID）和进程名称。

3.ss  需要安装 `iproute2` 包

```
ss -tuln | grep 7777
```

## 查看文件或目录路径

```
find / -name <文件或目录名称>
```

## 查看docker存储路径

如果你的服务器上有 Docker 运行，请使用以下命令来查找 Docker 的存储路径：

```
docker info --format '{{.DockerRootDir}}'
```

无论 Docker 的存储路径是什么，镜像文件通常位于该路径下的子目录中。例如，在默认路径 `/var/lib/docker/` 下，镜像文件将位于 `image/overlay2` 或类似的子目录中。

## 查看镜像存储路径

```
docker inspect --format='{{.GraphDriver.Data.MergedDir}}' <镜像名称或ID>
```

## 查找容器名称

查找**正在运行**的容器的名称

```
docker ps --format "{{.Names}}"
```

所有**包括停止状态**的容器的名称，可以加上 `-a` 或 `--all` 选项：

```
docker ps -a --format "{{.Names}}"
```

## 根据容器名称查看容器信息

```
docker inspect <容器名称或容器ID>
```

## 停止正在运行的容器

```
docker ps
```

可查看容器id

```
docker stop <container_id>
```

## 删除容器

```
docker rm <container_id>
```

## 查看某个进程

```
ps -ef | grep nginx
```

## 终止进程

```
sudo kill -s TERM 进程号
```

以[超级用户]权限向进程ID为14391的进程发送[终止信号]，请求该进程正常退出。

## 删除镜像

```
docker rmi myimage:tag
```

## 重启容器

```
docker restart 4e2b35a0d417
```

## 进去容器修改文件

```
docker exec -it 容器id bash
```

## 查看命令日志

```
history | grep 关键词
```



# webpack插件

|     plugin     |                             作用                             |
| :------------: | :----------------------------------------------------------: |
| SentryWebpack  | 集成 `Sentry` **错误日志**收集服务，`Sentry` 是一个开源的错误日志**收集和分析**服务，可以帮助开发人员更快地定位和修复错误。该插件主要用于在**生产环境**中收集应用程序的错误日志，并将其与特定的 **Git 提交**关联起来，以便更方便地进行错误分析和调试。 |
|    Workbox     | `WorkboxPlugin` 是一个用于生成 `Service Worker` 的插件，用于实现**离线缓存**和**资源预缓存**等功能。`Service Worker` 是在**浏览器**和**网络**之间运行的**脚本**，用于提供**离线访问**和**缓存资源**。该插件主要用于优化应用程序的性能和用户体验，特别是在网络不稳定或者没有网络的情况下。 |
|  Compression   | 该插件支持多种压缩算法，如 `gzip`、`brotli` 等。压缩构建**输出文件**可以有效地减小文件大小，从而提高应用程序的加载速度和性能。 |
| RetryChunkLoad | 用于重试加载 `Webpack` **拆分代码块**的插件。该插件主要用于处理**网络不稳定**或者网络超时等情况下的**代码块加载失败**问题。通过配置该插件，可以让应用程序在网络不稳定的情况下更加健壮和稳定。 |

## 使用打包进度条插件demo

创建一个新的项目**目录webpack**

1.添加**package.json**

```bash
npm init -y
```

2.安装webpack和progress-bar-webpack-plugin插件

```bash
npm install webpack webpack-cli progress-bar-webpack-plugin --save-dev
```

3.创建一个src/index.js文件

```bash
console.log("hello");
```

4.创建一个webpack.config.js文件

```js
const path = require('path');
const ProgressBarPlugin = require('progress-bar-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  plugins: [
    new ProgressBarPlugin()
  ]
};
```

5.使用**插件**打包

```bash
npx webpack --progress
```

--progress参数以**百分比**的形式显示打包进度，如果添加了插件才会以其他形式显示进度

Webpack将会编译你的项目，并在命令行中显示打包进度条。完成后，你可以在dist目录下找到生成的bundle.js文件。

## craco打包添加进度条

以下是一个简单的**示例项目**，演示如何在**React应用程序**中添加`webpackbar`插件来显示进度条。

1. 创建React应用程序

首先，你需要创建一个React应用程序。你可以使用`create-react-app`工具来快速创建一个React应用程序。在命令行中执行以下命令：

```bash
npx create-react-app my-app
cd my-app
```

2. 安装webpackbar插件

在应用程序目录中，使用以下命令安装`webpackbar`插件：

```
npm install webpackbar --save-dev
```

这个命令会将`webpackbar`插件安装到应用程序中，并将其添加到`package.json`文件的`devDependencies`部分中。

3. 修改craco配置文件

在应用程序目录中，创建一个名为`craco.config.js`的新文件，并添加以下代码：

```javascript
const WebpackBar = require('webpackbar');

module.exports = {
  plugins: [
    {
      plugin: {
        overrideWebpackConfig: ({webpackConfig, cracoConfig, pluginOptions, context: {env, paths}}) => {
          webpackConfig.plugins.push(new WebpackBar());
          return webpackConfig;
        },
      },
    },
  ],
};
```

这个配置文件使用`webpackbar`插件来显示构建进度条。在Webpack配置中添加`webpackbar`插件的代码是通过`overrideWebpackConfig`函数实现的。

4. 启动应用程序

在应用程序目录中，使用以下命令启动React应用程序：

```
npm start
```

这个命令会启动开发服务器，并在浏览器中打开React应用程序。在构建过程中，`webpackbar`插件会显示构建进度条和其他信息。

5. 构建应用程序

在应用程序目录中，使用以下命令构建React应用程序：

```
npm run build
```

这个命令会生成一个生产环境的构建，并将其输出到`build`目录中。在构建过程中，`webpackbar`插件会显示构建进度条和其他信息。

# 命令行

## 查看最新修改或新增文件

```bash
dir /O-D /T:W
```

## 查看主机ip

Windows 系统：

1. 打开命令提示符（Command Prompt）或 PowerShell。

2. 运行以下命令：

   ```
   ipconfig
   ```

   这将显示主机的网络配置信息，包括 IP 地址、子网掩码、默认网关等。在输出中找到 "IPv4 地址"，即可查看主机的 IP 地址。

Linux 系统：

1. 打开终端。

2. 运行以下命令之一：

   - 对于使用 ifconfig 命令的旧版 Linux 发行版：

     ```
   ifconfig
     ```

   - 对于使用 ip 命令的较新 Linux 发行版：
   
     ```
     ip addr show
     ```

   这将显示主机的网络接口信息，包括 IP 地址、子网掩码、广播地址等。在输出中找到与你的网络接口相关的部分，即可查看主机的 IP 地址。

请注意，在 Linux 中，你可能需要以管理员权限（使用 sudo 命令）运行上述命令才能查看完整的网络信息。

# 技巧

系统的**临时文件**存放位置配置在非C盘，通过**环境变量**配置，当磁盘内存紧缺时可以去那里清理



## 不同系统换行符

Visual Studio Code 编辑器中，你可以按 `Ctrl + Shift + H` 打开批量替换面板，然后启用正则表达式，并使用以下搜索和替换模式：

```
\r\n -> \n
```

包含的文件

```
./b_d/app/client/src
```

这将将所有回车符替换为 Unix 风格的换行符。

本地vscode编辑器也需要在eol设置中选择lf，

团队要是使用不同系统开发，需要在git配置设置

```bash
git config --global core.autocrlf false
```

高级写法：

```bash
git ls-files -z | xargs -0 perl -i -pe 's/\r$//g'
```

修改所有文件！

## 正则替换

**给img元素添加/**

搜索

```
<img\b([^>]*)src="([^"]*)"([^>]*)>
```

替换

```
<img$1src="$2"$3 />
```

可以将没有/的img替换成有/

比如

```
<img src="../.gitbook/assets/image (5).png" alt="">
```

替换成

```
<img src="../.gitbook/assets/image (5).png" alt="" />
```

**删除文件名间的空格**

```
| 需求描述                                              | 需求描述/展示                                                                                            | 参与者 |
| ------------------------------------------------- | -------------------------------------------------------------------------------------------------- | --- |
| Mysql数据源汉化翻译                                      | ![](</img/image (13) (3).png>)                                                    |     |
| Elasticsearch数据源汉化翻译                              | ![](</img/image (39).png>)                                                        |     |
| redis数据源汉化翻译                                      | ![](</img/image (18) (1) (2).png>)                                                |     |
| DynamoDB数据源汉化翻译                                   | ![](</img/image (37).png>)                                                        |     |
| Microsoft SQL Server数据源汉化翻译                       | ![](</img/image (16) (4).png>)                                                    |     |
| Firestore数据源汉化翻译                                  | ![](</img/image (28) (1) (3).png>)                                                |     |
| Redshift数据源汉化翻译                                   | ![](</img/image (3) (1) (4).png>)                                                 |     |
| S3数据源汉化翻译                                         | ![](</img/image (20) (4).png>)                                                    |     |
| Snowflake数据源汉化翻译                                  | ![](</img/image (44).png>)                                                        |     |
| ArangoDB数据源汉化翻译                                   | ![](</img/image (14) (5).png>)                                                    |     |
| SMTP数据源汉化翻译                                       | ![](</img/image (9) (1) (1).png>)                                                 |     |
| 发布页面后，在 table 单元格中使用 select 组件，进入编辑状态时，下拉框位置定位不正确 | [https://github.com/cloudtogo/pageplug/issues/22](https://github.com/cloudtogo/pageplug/issues/22) |     |
```

```
原始文本
(</img/image (39).png
查找表达式
\((<\/img\/image) \((\d+)\)(\.png)
替换表达式
($1($2)$3
原始文本
(</img/image (13) (3).png
查找表达式
\((<\/img\/image) \((\d+)\) \((\d+)\)*(\.png)
替换表达式
($1($2)($3)$4
原始文本
(</img/image (18) (1) (2).png
查找表达式
\((<\/img\/image) \((\d+)\) \((\d+)\) \((\d+)\)(\.png)
替换表达式
($1($2)($3)($4)$5
```



# yarn

## 查看当前的镜像源：

```
yarn config get registry
```

## 修改为淘宝镜像源：

```
yarn config set registry http://registry.npm.taobao.org
```

## 查看有效配置：

```
yarn config -v
```

# npm

## nrm

- `nrm ls`：列出当前可用的注册表。
- `nrm use <registry>`：切换到指定的注册表。
- `nrm add <registry> <url>`：添加一个自定义的注册表。
- `nrm del <registry>`：删除指定的注册表。

nrm 是一个用于管理 Node.js 包管理器（如 npm 和 Yarn）的注册表（registry）的工具。

# package.json

## 格式化脚本

```json
"prettify": "prettier --write \"src/**/*.ts\" \"src/**/*.tsx\" \"src/**/*.js\""
```

自动格式化 `src` 目录下的所有 `.ts`、`.tsx` 和 `.js` 文件

# lodash

## **sortedByUniqBy**

排除了经过**迭代函数**处理后相等的相邻元素，同时保留第一个出现的元素。该方法会先对数组进行排序，然后再进行处理。

```js
const ff = [{label: 'aaa',value: 'A'},{label: 'aaa1',value: 'A'},{label: 'bbb',value: 'B'}]
_.sortedUniqBy(ff, (i) => i.value)
// 返回
{label: 'aaa', value: 'A'}
{label: 'bbb', value: 'B'}
```

对于下拉菜单的**options**，**value要唯一**；

对于不唯一的数据，有三种思路处理：

- 数据库去重；
- 后端去重；
- 前端去重；



# nginx

## conf中定义变量

```bash
server {
    listen 80;
    server_name dev.appsmith.com;
    return 301 https://$host$request_uri;
}

server {
    listen 3600;
    location / {
        proxy_pass http://localhost:80;
    }
    return 301 https://$host$request_uri;
}

server {
	set $backend_url "http://10.10.14.135:8080";
	
    listen 443 ssl http2;
    server_name dev.appsmith.com;
    client_max_body_size 100m;

	# 证书跟本配置文件，均放在conf.d目录下
    ssl_certificate conf.d/dev.appsmith.com.pem;
    ssl_certificate_key conf.d/dev.appsmith.com-key.pem;

    # include /etc/letsencrypt/options-ssl-nginx.conf;
    # ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
    gzip on;

    proxy_ssl_server_name on;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header Accept-Encoding "";

    sub_filter_once off;
	
	# 前端服务
    location / {
        proxy_pass http://localhost:3000;
		# sub_filter __BMAP_AK__ '';
        # sub_filter __APPSMITH_BMAP_AK__ '';
    }

    location /favicon.ico {
        proxy_pass http://localhost:3000/favicon.ico;
    }

    location /f {
       proxy_pass https://cdn.optimizely.com/;
    }

	# 后端服务
    location /api {
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_pass $backend_url;
    }
	
	# 后端服务
    location /oauth2 {
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_pass $backend_url;
    }

	# 后端服务
    location /login {
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_pass $backend_url;
    }
}


```

## 域名转发

**步骤 1：安装 Nginx**

首先，确保你已经安装了 Nginx。如果没有安装，可以使用适用于你的操作系统的包管理工具进行安装。例如，在 Ubuntu 上可以使用以下命令：

```
sudo apt update
sudo apt install nginx
```

**步骤 2：获取 SSL 证书**

要启用 HTTPS，你需要获取一个有效的 SSL 证书。你可以从证书颁发机构（CA）购买，也可以使用免费的证书颁发机构（如 Let's Encrypt）获取证书。

如果你使用 Let's Encrypt，可以按照以下步骤安装 Certbot 工具并获取证书：

1. 安装 Certbot：

   ```
   sudo apt install certbot python3-certbot-nginx
   ```
   
2. 获取证书（假设你的域名是 example.com）：

   ```
   sudo certbot --nginx -d example.com -d www.example.com
   ```

**步骤 3：配置 Nginx 支持 HTTPS**

1. 打开 Nginx 的站点配置文件，通常位于 `/etc/nginx/` 目录下。选择你想配置 HTTPS 的站点，并编辑配置文件：

   ```
   sudo nano /etc/nginx/sites-available/your_site_config_file
   ```
   
2. 在配置文件中添加以下内容，以启用 HTTPS：

   ```nginx
server {
       listen 80;
       server_name example.com www.example.com;
   
       # Redirect HTTP to HTTPS
       return 301 https://$host$request_uri;
   }
   
   server {
       listen 443 ssl;
       server_name example.com www.example.com;
   
       ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
       ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
   
       # SSL settings
       ssl_protocols TLSv1.2 TLSv1.3;
       ssl_prefer_server_ciphers off;
   
       location / {
           # Your other server configuration directives
       }
   }
   ```
   
   注意替换 `example.com` 和配置文件的路径，确保 ssl_certificate 和 ssl_certificate_key 的路径正确指向你的 SSL 证书。

3. 保存并关闭文件。

**步骤 4：测试配置并重新加载 Nginx**

1. 检查 Nginx 配置是否正确：

   ```
   sudo nginx -t
   ```
   
2. 如果没有错误，重新加载 Nginx 配置：

   ```
   sudo systemctl reload nginx
   ```

**步骤 5：设置自动续签**

Let's Encrypt 证书的有效期为 90 天。为了避免证书过期，你可以设置自动续签。可以创建一个 cron 作业来定期续签证书。

编辑 crontab 文件：

```
sudo crontab -e
```

在文件末尾添加以下行（每天凌晨续签）：

```
0 0 * * * /usr/bin/certbot renew --quiet
```

保存并关闭文件。

## 防火墙规则查看

```
sudo iptables -L
```

## 查看端口已经被占用

```
sudo netstat -tuln | grep 81
```

## 杀死所有nginx进程

```
sudo pkill nginx
```



## 报错

想重启nginx

执行`nignx -s stop`时

1.nginx: [error] invalid PID number "" in "/run/nginx.pid"

nginx -s reload 仅用于告诉正在运行的 nginx 进程重新加载其配置。停止后，没有正在运行的 nginx 进程来发送信号。只需运行nginx（可能使用-c /path/to/config/file）

2.执行`sudo systemctl reload nginx`日志

```bash
Failed to reload nginx.service: Connection timed out
See system logs and 'systemctl status nginx.service' for details.
```

可并不是是用systemctl管理nginx的，可以试试
`nginx -s reload`

# 样式积累

## 子元素写>与不写的区别

```css
li>a
```

表示li的直接子元素a

```css
li a
```

表示li的**间距**子元素（有可能是子孙）

## flex控制顺序

**order**，数字越小越靠前；

## hint效果

```css
.hint {
  background-color: #f5f7f9;
  border-radius: 4px;
  border: 1px solid #dcdcdc;
  border-left: 4px solid #346ddb;
  padding: 20px;
  margin: 10px 0;
}
```

使用

```html
<div class="hint" markdown="1">

</div>
```

## 白天/黑夜模式切换，匹配内容不同样式

**方案一**

两种文件，监听切换事件，切换link的href

假设是react

```jsx
import React, { useState } from 'react';

const ExamplePage = () => {
  const [isDarkMode, setIsDarkMode] = useState(false);

  const handleModeChange = () => {
    setIsDarkMode(!isDarkMode);
    const themeLink = document.getElementById('theme-link');
    themeLink.href = isDarkMode ? '/path/to/light.css' : '/path/to/dark.css';
  };

  return (
    <div>
      <h1>Example Page</h1>
      <button onClick={handleModeChange}>
        {isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'}
      </button>
    </div>
  );
};

export default ExamplePage;
```

使用了 React 的 `useState` 钩子来管理当前的模式状态，初始状态为白天模式（`isDarkMode` 为 `false`）；

`handleModeChange` 函数会在按钮点击时触发，它会根据当前模式状态切换到相应的模式，并更新样式文件的链接。

接下来，你需要在你的项目中的某个布局文件（比如说是 `src/theme/Layout.js`）中添加以下代码，以引入样式文件：

```jsx
import React from 'react';

const Layout = () => {
  return (
    <div>
      <head>
        <link id="theme-link" rel="stylesheet" href="/path/to/light.css" />
      </head>
      {/* 布局的其他内容 */}
    </div>
  );
};

export default Layout;
```

在上述代码中，我们在 `<head>` 元素中添加了一个带有 `id` 为 `"theme-link"` 的链接标签，初始时它的 `href` 属性指向白天模式的样式文件。

现在，当你在浏览器中打开该示例页面时，你会看到一个标题和一个切换模式的按钮。点击按钮时，样式文件的链接将会根据当前模式状态切换。

需要将 `/path/to/light.css` 和 `/path/to/dark.css` 替换为实际的样式文件路径。

**方案二**

使用html的属性切换（data-theme）

这是light模式下

```css
.hint {
  background-color: #f5f7f9;
  border-radius: 4px;
  border: 1px solid #dcdcdc;
  border-left: 4px solid #346ddb;
  padding: 20px;
  margin: 10px 0;
}
```

这是dark模式

```
html[data-theme='dark'] .hint {
  background-color: #a1bba8;
  border-radius: 4px;
  border: 1px solid #dcdcdc;
  border-left: 4px solid #346ddb;
  padding: 20px;
  margin: 10px 0;
}
```



# window

## 滚动到顶部--整个页面的顶部

```html
<!DOCTYPE html>
<html lang="ch-ZN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>js实现页面滚动返回顶部</title>
  <style>
    * {
      padding: 0px;
      margin: 0px;
    }

    div {
      width: 1200px;
      height: 300px;
      margin: 50px auto;
      font-size: 120px;
      line-height: 300px;
      text-align: center;
      color: #ffffff;
      background-color: #999999;
    }

    button {
      position: fixed;
      bottom: 40px;
      right: 40px;
      width: 60px;
      height: 60px;
      border: 0px;
      border-radius: 10px;
      font-size: 24px;
      line-height: 30px;
      text-align: center;
      color: #000;
      background-color: #c5e4ff;
      outline: none;
      cursor: pointer;
    }

    button:hover {
      color: #fff;
      background-color: #5fb4ff;
    }
  </style>
</head>

<body>
  <div>模块1</div>
  <div>模块2</div>
  <div>模块3</div>
  <div>模块4</div>
  <div>模块5</div>
  <div>模块6</div>
  <div>模块7</div>
  <div>模块8</div>
  <div>模块9</div>
  <button>返回顶部</button>
  <script>
    var btn = document.querySelector('button'); // 获取元素
    var timer; // 用来储存计时器的变量
    btn.addEventListener('click', function () {
      clearInterval(timer); // 先停止上次的计时器（防止连点）
      timer = setInterval(function () {
        // 判断是否已经滚动到了顶部
        if (window.pageYOffset != 0) {
          // 如果没到顶部就再移动一点距离（我这里是一次移动了50像素）
          window.scroll(0, Math.max(window.pageYOffset - 50, 0));
        } else {
          // 如果到顶部了就停止计时器
          clearInterval(timer);
        }
      }, 10);
    })
  </script>
</body>

</html>

```

## 滚动到顶部--容器内

```js
function toTop() {
  var sidebar = document.querySelector('.sidebar-nav');
  var content = document.querySelector('.markdown-section');

  sidebar.addEventListener('click', function () {
    content.scroll(0, -content.scrollHeight)
  });
}
```

# git

## 修改remote

先用

```
git remote -v
```

检查下现有的远程出库地址

确认之后修改

```
git remote set-url origin https://gitee.com/zhai-sifeng/docs.git
```

## 删除

```
git remote rm origin
```

# md语法

```
[desc](url) 链接
[https://blog.csdn.net](https://blog.csdn.net)这样可以显示该站点预览信息
> 左边涂料，类似hint效果

```



# pageplug

## 配置面板的属性如何传递给画布中的组件？

1. 在组件类中,会定义一些静态方法来生成配置面板的配置,比如 `getPropertyPaneConfig`。
2. 这些配置会定义出配置面板中的各个属性,每个属性都会有一个 `propertyName` 来指定属性名。
3. 当用户在配置面板中修改某个属性时,会触发 redux 的 action,将新值存入对应组件的 redux state 中。
4. 组件会监听自己在 redux state 中的数据,一旦发生变更,就会触发重新渲染。
5. 在组件渲染时,会从 redux state 中读取最新的值,传递给相应的组件属性。
6. 这样就完成了从配置面板到组件属性的同步。
7. 对于一些需要转换的属性,组件类中还可以定义 `getDerivedPropertiesMap` 方法来进行转换后再传递给组件。

所以简单来说,配置面板通过 redux 将属性变化反映到组件的 props 中,组件感知到 props 变化后重新渲染,就可以获取到最新的属性值了

## 自定义组件流程

### 注册

**utils/widgetRegistry.tsx**

```tsx
import log from "loglevel";
import { registerWidget } from "./WidgetRegisterHelpers";
import AnimationWidget, {
  CONFIG as ANIMATION_WIDGET_CONFIG,
} from "widgets/AnimationWidget";

export const ALL_WIDGETS_AND_CONFIG: [any, WidgetConfiguration][] = [[AnimationWidget, ANIMATION_WIDGET_CONFIG]]

export const registerWidgets = () => {
  const start = performance.now();
  for (const widget of ALL_WIDGETS_AND_CONFIG) {
    registerWidget(widget[0], widget[1] as WidgetConfiguration);
  }

  log.debug("Widget registration took: ", performance.now() - start, "ms");
};
```

**WidgetRegisterHelpers.tsx**

```tsx
import React from "react";

import * as Sentry from "@sentry/react";
import store from "store";

import type BaseWidget from "widgets/BaseWidget";
import WidgetFactory, { NonSerialisableWidgetConfigs } from "./WidgetFactory";

import { ReduxActionTypes } from "@appsmith/constants/ReduxActionConstants";
import { memoize } from "lodash";
import type { WidgetConfiguration } from "widgets/constants";
import withMeta from "widgets/MetaHOC";
import withWidgetProps from "widgets/withWidgetProps";
import { generateReactKey } from "./generators";
import type { RegisteredWidgetFeatures } from "./WidgetFeatures";
import {
  WidgetFeaturePropertyEnhancements,
  WidgetFeatureProps,
} from "./WidgetFeatures";
import { withLazyRender } from "widgets/withLazyRender";

const generateWidget = memoize(function getWidgetComponent(
  Widget: typeof BaseWidget,
  needsMeta: boolean,
  eagerRender: boolean,
) {
  let widget = needsMeta ? withMeta(Widget) : Widget;

  //@ts-expect-error: type mismatch
  widget = withWidgetProps(widget);

  //@ts-expect-error: type mismatch
  widget = eagerRender ? widget : withLazyRender(widget);

  return Sentry.withProfiler(
    // @ts-expect-error: Types are not available
    widget,
  );
});

export const registerWidget = (Widget: any, config: WidgetConfiguration) => {
  const ProfiledWidget = generateWidget(
    Widget,
    !!config.needsMeta,
    !!config.eagerRender,
  );

  WidgetFactory.registerWidgetBuilder(
    config.type,
    {
      buildWidget(widgetData: any): JSX.Element {
        return <ProfiledWidget {...widgetData} key={widgetData.widgetId} />;
      },
    },
    config.properties.derived,
    config.properties.default,
    config.properties.meta,
    config.properties.config,
    config.properties.contentConfig,
    config.properties.styleConfig,
    config.features,
    config.properties.loadingProperties,
    config.properties.stylesheetConfig,
    config.properties.autocompleteDefinitions,
    config.autoLayout,
  );
  configureWidget(config);
};

export const configureWidget = (config: WidgetConfiguration) => {
  let features: Record<string, unknown> = {};
  if (config.features) {
    Object.keys(config.features).forEach((registeredFeature: string) => {
      features = Object.assign(
        {},
        WidgetFeatureProps[registeredFeature as RegisteredWidgetFeatures],
        WidgetFeaturePropertyEnhancements[
          registeredFeature as RegisteredWidgetFeatures
        ](config),
      );
    });
  }

  const _config = {
    ...config.defaults,
    ...features,
    searchTags: config.searchTags,
    type: config.type,
    hideCard: !!config.hideCard || !config.iconSVG,
    isDeprecated: !!config.isDeprecated,
    replacement: config.replacement,
    displayName: config.name,
    key: generateReactKey(),
    iconSVG: config.iconSVG,
    isCanvas: config.isCanvas,
    canvasHeightOffset: config.canvasHeightOffset,
    needsHeightForContent: config.needsHeightForContent,
    isMobile: config.isMobile,
    isScreen: config.isScreen,
  };

  const nonSerialisableWidgetConfigs: Record<string, unknown> = {};
  Object.values(NonSerialisableWidgetConfigs).forEach((entry) => {
    if (_config[entry] !== undefined) {
      nonSerialisableWidgetConfigs[entry] = _config[entry];
    }
    delete _config[entry];
  });

  WidgetFactory.storeNonSerialisablewidgetConfig(
    config.type,
    nonSerialisableWidgetConfigs,
  );
  WidgetFactory.storeWidgetConfig(config.type, _config);

  store.dispatch({
    type: ReduxActionTypes.ADD_WIDGET_CONFIG,
    payload: _config,
  });
};

```

### 属性面板

组件目录的widget/index.tsx的**getPropertyPaneContentConfig**；

返回的数组中元素是对象，对象中children字段又是个数组，该数组元素又是个对象，该对象的**propertyName**字段就是组件的**props**

```tsx
import { Alignment } from "@blueprintjs/core";
import { LabelPosition } from "components/constants";
import { EventType } from "constants/AppsmithActionConstants/ActionConstants";
import { Layers } from "constants/Layers";
import type { TextSize, WidgetType } from "constants/WidgetConstants";
import type { ValidationResponse } from "constants/WidgetValidation";
import { ValidationTypes } from "constants/WidgetValidation";
import type { Stylesheet } from "entities/AppTheming";
import { EvaluationSubstitutionType } from "entities/DataTree/dataTreeFactory";
import { isArray } from "lodash";
import type { DefaultValueType } from "rc-tree-select/lib/interface";
import type { ReactNode } from "react";
import React from "react";
import { AutocompleteDataType } from "utils/autocomplete/AutocompleteDataType";
import type { WidgetProps, WidgetState } from "widgets/BaseWidget";
import BaseWidget from "widgets/BaseWidget";
import { isAutoLayout } from "utils/autoLayout/flexWidgetUtils";
import { GRID_DENSITY_MIGRATION_V1, MinimumPopupRows } from "widgets/constants";
import {
  isAutoHeightEnabledForWidget,
  DefaultAutocompleteDefinitions,
} from "widgets/WidgetUtils";
import SingleSelectTreeComponent from "../component";
import derivedProperties from "./parseDerivedProperties";
import type { AutocompletionDefinitions } from "widgets/constants";

function defaultOptionValueValidation(value: unknown): ValidationResponse {
  if (typeof value === "string") return { isValid: true, parsed: value.trim() };
  if (value === undefined || value === null)
    return {
      isValid: false,
      parsed: "",
      messages: [
        {
          name: "TypeError",
          message: "This value does not evaluate to type: string",
        },
      ],
    };
  return { isValid: true, parsed: value };
}
class SingleSelectTreeWidget extends BaseWidget<
  SingleSelectTreeWidgetProps,
  WidgetState
> {
  static getPropertyPaneContentConfig() {
    return [
      {
        sectionName: "数据",
        children: [
          {
            helpText: "允许用户多选，每个选项的值必须唯一",
            propertyName: "options",
            label: "选项",
            controlType: "INPUT_TEXT",
            placeholderText: "请输入选项数据",
            isBindProperty: true,
            isTriggerProperty: false,
            isJSConvertible: false,
            validation: {
              type: ValidationTypes.NESTED_OBJECT_ARRAY,
              params: {
                unique: ["value"],
                default: [],
                children: {
                  type: ValidationTypes.OBJECT,
                  params: {
                    allowedKeys: [
                      {
                        name: "label",
                        type: ValidationTypes.TEXT,
                        params: {
                          default: "",
                          required: true,
                        },
                      },
                      {
                        name: "value",
                        type: ValidationTypes.TEXT,
                        params: {
                          default: "",
                        },
                      },
                      {
                        name: "children",
                        type: ValidationTypes.ARRAY,
                        required: false,
                        params: {
                          children: {
                            type: ValidationTypes.OBJECT,
                            params: {
                              allowedKeys: [
                                {
                                  name: "label",
                                  type: ValidationTypes.TEXT,
                                  params: {
                                    default: "",
                                    required: true,
                                  },
                                },
                                {
                                  name: "value",
                                  type: ValidationTypes.TEXT,
                                  params: {
                                    default: "",
                                  },
                                },
                              ],
                            },
                          },
                        },
                      },
                    ],
                  },
                },
              },
            },
            evaluationSubstitutionType:
              EvaluationSubstitutionType.SMART_SUBSTITUTE,
          },
          {
            helpText: "默认选中这个值",
            propertyName: "defaultOptionValue",
            label: "默认选中值",
            controlType: "INPUT_TEXT",
            placeholderText: "请输入选项数据",
            isBindProperty: true,
            isTriggerProperty: false,
            validation: {
              type: ValidationTypes.FUNCTION,
              params: {
                fn: defaultOptionValueValidation,
                expected: {
                  type: "value",
                  example: `value1`,
                  autocompleteDataType: AutocompleteDataType.STRING,
                },
              },
            },
          },
        ],
      },
      {
        sectionName: "标签",
        children: [
          {
            helpText: "设置组件标签文本",
            propertyName: "labelText",
            label: "文本",
            controlType: "INPUT_TEXT",
            placeholderText: "请输入文本内容",
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            helpText: "设置组件标签位置",
            propertyName: "labelPosition",
            label: "位置",
            controlType: "ICON_TABS",
            fullWidth: true,
            hidden: isAutoLayout,
            options: [
              { label: "自动", value: LabelPosition.Auto },
              { label: "左", value: LabelPosition.Left },
              { label: "上", value: LabelPosition.Top },
            ],
            defaultValue: LabelPosition.Top,
            isBindProperty: false,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            helpText: "设置组件标签的对齐方式",
            propertyName: "labelAlignment",
            label: "对齐",
            controlType: "LABEL_ALIGNMENT_OPTIONS",
            options: [
              {
                icon: "LEFT_ALIGN",
                value: Alignment.LEFT,
              },
              {
                icon: "RIGHT_ALIGN",
                value: Alignment.RIGHT,
              },
            ],
            isBindProperty: false,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
            hidden: (props: SingleSelectTreeWidgetProps) =>
              props.labelPosition !== LabelPosition.Left,
            dependencies: ["labelPosition"],
          },
          {
            helpText: "设置组件标签占用的列数",
            propertyName: "labelWidth",
            label: "宽度（所占列数）",
            controlType: "NUMERIC_INPUT",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            min: 0,
            validation: {
              type: ValidationTypes.NUMBER,
              params: {
                natural: true,
              },
            },
            hidden: (props: SingleSelectTreeWidgetProps) =>
              props.labelPosition !== LabelPosition.Left,
            dependencies: ["labelPosition"],
          },
        ],
      },
      {
        sectionName: "校验",
        children: [
          {
            propertyName: "isRequired",
            label: "必填",
            helpText: "强制用户填写",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
        ],
      },
      {
        sectionName: "属性",
        children: [
          {
            helpText: "提示信息",
            propertyName: "labelTooltip",
            label: "提示",
            controlType: "INPUT_TEXT",
            placeholderText: "添加提示信息",
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            helpText: "设置占位文本",
            propertyName: "placeholderText",
            label: "占位符",
            controlType: "INPUT_TEXT",
            placeholderText: "请输入占位文本",
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            helpText: "控制组件的显示/隐藏",
            propertyName: "isVisible",
            label: "是否显示",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
          {
            propertyName: "isDisabled",
            label: "禁用",
            helpText: "让组件不可交互",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
          {
            propertyName: "animateLoading",
            label: "加载时显示动画",
            controlType: "SWITCH",
            helpText: "组件依赖的数据加载时显示加载动画",
            defaultValue: true,
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
          {
            propertyName: "allowClear",
            label: "允许清空",
            helpText: "显示清空按钮用来清空选择",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
          {
            propertyName: "expandAll",
            label: "默认展开",
            helpText: "默认展开所有层级的选项",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
        ],
      },
      {
        sectionName: "事件",
        children: [
          {
            helpText: "用户选中一个选项时触发",
            propertyName: "onOptionChange",
            label: "onOptionChange",
            controlType: "ACTION_SELECTOR",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: true,
          },
          {
            helpText: "when the dropdown opens",
            propertyName: "onDropdownOpen",
            label: "onDropdownOpen",
            controlType: "ACTION_SELECTOR",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: true,
          },
          {
            helpText: "when the dropdown closes",
            propertyName: "onDropdownClose",
            label: "onDropdownClose",
            controlType: "ACTION_SELECTOR",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: true,
          },
        ],
      },
    ];
  }

  static getStylesheetConfig(): Stylesheet {
    return {
      accentColor: "{{appsmith.theme.colors.primaryColor}}",
      borderRadius: "{{appsmith.theme.borderRadius.appBorderRadius}}",
      boxShadow: "none",
    };
  }

  static getPropertyPaneStyleConfig() {
    return [
      {
        sectionName: "标签样式",
        children: [
          {
            propertyName: "labelTextColor",
            label: "字体颜色",
            helpText: "设置标签字体颜色",
            controlType: "COLOR_PICKER",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            propertyName: "labelTextSize",
            label: "字体大小",
            helpText: "设置标签字体大小",
            controlType: "DROP_DOWN",
            defaultValue: "0.875rem",
            hidden: isAutoLayout,
            options: [
              {
                label: "S",
                value: "0.875rem",
                subText: "0.875rem",
              },
              {
                label: "M",
                value: "1rem",
                subText: "1rem",
              },
              {
                label: "L",
                value: "1.25rem",
                subText: "1.25rem",
              },
              {
                label: "XL",
                value: "1.875rem",
                subText: "1.875rem",
              },
              {
                label: "XXL",
                value: "3rem",
                subText: "3rem",
              },
              {
                label: "3XL",
                value: "3.75rem",
                subText: "3.75rem",
              },
            ],
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            propertyName: "labelStyle",
            label: "强调",
            helpText: "设置标签字体是否加粗或斜体",
            controlType: "BUTTON_GROUP",
            options: [
              {
                icon: "BOLD_FONT",
                value: "BOLD",
              },
              {
                icon: "ITALICS_FONT",
                value: "ITALIC",
              },
            ],
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
        ],
      },
      {
        sectionName: "轮廓样式",
        children: [
          {
            propertyName: "accentColor",
            label: "强调色",
            controlType: "COLOR_PICKER",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
            invisible: true,
          },
          {
            propertyName: "borderRadius",
            label: "边框圆角",
            helpText: "边框圆角样式",
            controlType: "BORDER_RADIUS_OPTIONS",

            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            propertyName: "boxShadow",
            label: "阴影",
            helpText: "组件轮廓投影",
            controlType: "BOX_SHADOW_OPTIONS",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
        ],
      },
    ];
  }

  static getAutocompleteDefinitions(): AutocompletionDefinitions {
    return {
      "!doc":
        "TreeSelect is used to capture user input from a specified list of permitted inputs/Nested Inputs.",
      "!url": "https://docs.appsmith.com/widget-reference/treeselect",
      isVisible: DefaultAutocompleteDefinitions.isVisible,
      selectedOptionValue: {
        "!type": "string",
        "!doc": "The value selected in a treeselect dropdown",
        "!url": "https://docs.appsmith.com/widget-reference/treeselect",
      },
      selectedOptionLabel: {
        "!type": "string",
        "!doc": "The selected option label in a treeselect dropdown",
        "!url": "https://docs.appsmith.com/widget-reference/treeselect",
      },
      isDisabled: "bool",
      isValid: "bool",
      options: "[$__dropdownOption__$]",
    };
  }

  static getDerivedPropertiesMap() {
    return {
      value: `{{this.selectedOptionValue}}`,
      flattenedOptions: `{{(()=>{${derivedProperties.getFlattenedOptions}})()}}`,
      isValid: `{{(()=>{${derivedProperties.getIsValid}})()}}`,
      selectedOptionValue: `{{(()=>{${derivedProperties.getSelectedOptionValue}})()}}`,
      selectedOptionLabel: `{{(()=>{${derivedProperties.getSelectedOptionLabel}})()}}`,
    };
  }

  static getDefaultPropertiesMap(): Record<string, string> {
    return {
      selectedOption: "defaultOptionValue",
      selectedLabel: "defaultOptionValue",
    };
  }

  static getMetaPropertiesMap(): Record<string, any> {
    return {
      selectedOption: undefined,
      selectedLabel: undefined,
      isDirty: false,
    };
  }

  componentDidUpdate(prevProps: SingleSelectTreeWidgetProps): void {
    if (
      this.props.defaultOptionValue !== prevProps.defaultOptionValue &&
      this.props.isDirty
    ) {
      this.props.updateWidgetMetaProperty("isDirty", false);
    }
  }

  getPageView() {
    const options = isArray(this.props.options) ? this.props.options : [];
    const isInvalid =
      "isValid" in this.props && !this.props.isValid && !!this.props.isDirty;
    const dropDownWidth = MinimumPopupRows * this.props.parentColumnSpace;
    const { componentWidth } = this.getComponentDimensions();
    return (
      <SingleSelectTreeComponent
        accentColor={this.props.accentColor}
        allowClear={this.props.allowClear}
        borderRadius={this.props.borderRadius}
        boxShadow={this.props.boxShadow}
        compactMode={
          !(
            (this.props.bottomRow - this.props.topRow) /
              GRID_DENSITY_MIGRATION_V1 >
            1
          )
        }
        disabled={this.props.isDisabled ?? false}
        dropDownWidth={dropDownWidth}
        dropdownStyle={{
          zIndex: Layers.dropdownModalWidget,
        }}
        expandAll={this.props.expandAll}
        isDynamicHeightEnabled={isAutoHeightEnabledForWidget(this.props)}
        isFilterable
        isValid={!isInvalid}
        labelAlignment={this.props.labelAlignment}
        labelPosition={this.props.labelPosition}
        labelStyle={this.props.labelStyle}
        labelText={this.props.labelText}
        labelTextColor={this.props.labelTextColor}
        labelTextSize={this.props.labelTextSize}
        labelTooltip={this.props.labelTooltip}
        labelWidth={this.getLabelWidth()}
        loading={this.props.isLoading}
        onChange={this.onOptionChange}
        onDropdownClose={this.onDropdownClose}
        onDropdownOpen={this.onDropdownOpen}
        options={options}
        placeholder={this.props.placeholderText as string}
        renderMode={this.props.renderMode}
        value={this.props.selectedOptionValue}
        widgetId={this.props.widgetId}
        width={componentWidth}
      />
    );
  }

  onOptionChange = (value?: DefaultValueType, labelList?: ReactNode[]) => {
    if (!this.props.isDirty) {
      this.props.updateWidgetMetaProperty("isDirty", true);
    }

    this.props.updateWidgetMetaProperty("selectedOption", value);
    this.props.updateWidgetMetaProperty("selectedLabel", labelList?.[0] ?? "", {
      triggerPropertyName: "onOptionChange",
      dynamicString: this.props.onOptionChange,
      event: {
        type: EventType.ON_OPTION_CHANGE,
      },
    });
  };

  onDropdownOpen = () => {
    if (this.props.onDropdownOpen) {
      super.executeAction({
        triggerPropertyName: "onDropdownOpen",
        dynamicString: this.props.onDropdownOpen,
        event: {
          type: EventType.ON_DROPDOWN_OPEN,
        },
      });
    }
  };

  onDropdownClose = () => {
    if (this.props.onDropdownClose) {
      super.executeAction({
        triggerPropertyName: "onDropdownClose",
        dynamicString: this.props.onDropdownClose,
        event: {
          type: EventType.ON_DROPDOWN_CLOSE,
        },
      });
    }
  };

  static getWidgetType(): WidgetType {
    return "SINGLE_SELECT_TREE_WIDGET";
  }
}

export interface DropdownOption {
  label: string;
  value: string | number;
  disabled?: boolean;
  children?: DropdownOption[];
}

export interface SingleSelectTreeWidgetProps extends WidgetProps {
  placeholderText?: string;
  selectedIndex?: number;
  options?: DropdownOption[];
  flattenedOptions?: DropdownOption[];
  onOptionChange: string;
  onDropdownOpen?: string;
  onDropdownClose?: string;
  defaultOptionValue: string;
  isRequired: boolean;
  isLoading: boolean;
  allowClear: boolean;
  selectedLabel: string[];
  selectedOption: string | number;
  selectedOptionValue: string;
  selectedOptionLabel: string;
  expandAll: boolean;
  labelText: string;
  labelPosition?: LabelPosition;
  labelAlignment?: Alignment;
  labelWidth?: number;
  labelTextColor?: string;
  labelTextSize?: TextSize;
  labelStyle?: string;
  borderRadius: string;
  boxShadow?: string;
  accentColor: string;
  isDirty?: boolean;
}

export default SingleSelectTreeWidget;

```

### 样式面板

组件目录的widget/index.tsx的**getPropertyPaneStyleConfig**

```tsx
import { Alignment } from "@blueprintjs/core";
import { LabelPosition } from "components/constants";
import { EventType } from "constants/AppsmithActionConstants/ActionConstants";
import { Layers } from "constants/Layers";
import type { TextSize, WidgetType } from "constants/WidgetConstants";
import type { ValidationResponse } from "constants/WidgetValidation";
import { ValidationTypes } from "constants/WidgetValidation";
import type { Stylesheet } from "entities/AppTheming";
import { EvaluationSubstitutionType } from "entities/DataTree/dataTreeFactory";
import { isArray } from "lodash";
import type { DefaultValueType } from "rc-tree-select/lib/interface";
import type { ReactNode } from "react";
import React from "react";
import { AutocompleteDataType } from "utils/autocomplete/AutocompleteDataType";
import type { WidgetProps, WidgetState } from "widgets/BaseWidget";
import BaseWidget from "widgets/BaseWidget";
import { isAutoLayout } from "utils/autoLayout/flexWidgetUtils";
import { GRID_DENSITY_MIGRATION_V1, MinimumPopupRows } from "widgets/constants";
import {
  isAutoHeightEnabledForWidget,
  DefaultAutocompleteDefinitions,
} from "widgets/WidgetUtils";
import SingleSelectTreeComponent from "../component";
import derivedProperties from "./parseDerivedProperties";
import type { AutocompletionDefinitions } from "widgets/constants";

function defaultOptionValueValidation(value: unknown): ValidationResponse {
  if (typeof value === "string") return { isValid: true, parsed: value.trim() };
  if (value === undefined || value === null)
    return {
      isValid: false,
      parsed: "",
      messages: [
        {
          name: "TypeError",
          message: "This value does not evaluate to type: string",
        },
      ],
    };
  return { isValid: true, parsed: value };
}
class SingleSelectTreeWidget extends BaseWidget<
  SingleSelectTreeWidgetProps,
  WidgetState
> {
  static getPropertyPaneContentConfig() {
    return [
      {
        sectionName: "数据",
        children: [
          {
            helpText: "允许用户多选，每个选项的值必须唯一",
            propertyName: "options",
            label: "选项",
            controlType: "INPUT_TEXT",
            placeholderText: "请输入选项数据",
            isBindProperty: true,
            isTriggerProperty: false,
            isJSConvertible: false,
            validation: {
              type: ValidationTypes.NESTED_OBJECT_ARRAY,
              params: {
                unique: ["value"],
                default: [],
                children: {
                  type: ValidationTypes.OBJECT,
                  params: {
                    allowedKeys: [
                      {
                        name: "label",
                        type: ValidationTypes.TEXT,
                        params: {
                          default: "",
                          required: true,
                        },
                      },
                      {
                        name: "value",
                        type: ValidationTypes.TEXT,
                        params: {
                          default: "",
                        },
                      },
                      {
                        name: "children",
                        type: ValidationTypes.ARRAY,
                        required: false,
                        params: {
                          children: {
                            type: ValidationTypes.OBJECT,
                            params: {
                              allowedKeys: [
                                {
                                  name: "label",
                                  type: ValidationTypes.TEXT,
                                  params: {
                                    default: "",
                                    required: true,
                                  },
                                },
                                {
                                  name: "value",
                                  type: ValidationTypes.TEXT,
                                  params: {
                                    default: "",
                                  },
                                },
                              ],
                            },
                          },
                        },
                      },
                    ],
                  },
                },
              },
            },
            evaluationSubstitutionType:
              EvaluationSubstitutionType.SMART_SUBSTITUTE,
          },
          {
            helpText: "默认选中这个值",
            propertyName: "defaultOptionValue",
            label: "默认选中值",
            controlType: "INPUT_TEXT",
            placeholderText: "请输入选项数据",
            isBindProperty: true,
            isTriggerProperty: false,
            validation: {
              type: ValidationTypes.FUNCTION,
              params: {
                fn: defaultOptionValueValidation,
                expected: {
                  type: "value",
                  example: `value1`,
                  autocompleteDataType: AutocompleteDataType.STRING,
                },
              },
            },
          },
        ],
      },
      {
        sectionName: "标签",
        children: [
          {
            helpText: "设置组件标签文本",
            propertyName: "labelText",
            label: "文本",
            controlType: "INPUT_TEXT",
            placeholderText: "请输入文本内容",
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            helpText: "设置组件标签位置",
            propertyName: "labelPosition",
            label: "位置",
            controlType: "ICON_TABS",
            fullWidth: true,
            hidden: isAutoLayout,
            options: [
              { label: "自动", value: LabelPosition.Auto },
              { label: "左", value: LabelPosition.Left },
              { label: "上", value: LabelPosition.Top },
            ],
            defaultValue: LabelPosition.Top,
            isBindProperty: false,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            helpText: "设置组件标签的对齐方式",
            propertyName: "labelAlignment",
            label: "对齐",
            controlType: "LABEL_ALIGNMENT_OPTIONS",
            options: [
              {
                icon: "LEFT_ALIGN",
                value: Alignment.LEFT,
              },
              {
                icon: "RIGHT_ALIGN",
                value: Alignment.RIGHT,
              },
            ],
            isBindProperty: false,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
            hidden: (props: SingleSelectTreeWidgetProps) =>
              props.labelPosition !== LabelPosition.Left,
            dependencies: ["labelPosition"],
          },
          {
            helpText: "设置组件标签占用的列数",
            propertyName: "labelWidth",
            label: "宽度（所占列数）",
            controlType: "NUMERIC_INPUT",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            min: 0,
            validation: {
              type: ValidationTypes.NUMBER,
              params: {
                natural: true,
              },
            },
            hidden: (props: SingleSelectTreeWidgetProps) =>
              props.labelPosition !== LabelPosition.Left,
            dependencies: ["labelPosition"],
          },
        ],
      },
      {
        sectionName: "校验",
        children: [
          {
            propertyName: "isRequired",
            label: "必填",
            helpText: "强制用户填写",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
        ],
      },
      {
        sectionName: "属性",
        children: [
          {
            helpText: "提示信息",
            propertyName: "labelTooltip",
            label: "提示",
            controlType: "INPUT_TEXT",
            placeholderText: "添加提示信息",
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            helpText: "设置占位文本",
            propertyName: "placeholderText",
            label: "占位符",
            controlType: "INPUT_TEXT",
            placeholderText: "请输入占位文本",
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            helpText: "控制组件的显示/隐藏",
            propertyName: "isVisible",
            label: "是否显示",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
          {
            propertyName: "isDisabled",
            label: "禁用",
            helpText: "让组件不可交互",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
          {
            propertyName: "animateLoading",
            label: "加载时显示动画",
            controlType: "SWITCH",
            helpText: "组件依赖的数据加载时显示加载动画",
            defaultValue: true,
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
          {
            propertyName: "allowClear",
            label: "允许清空",
            helpText: "显示清空按钮用来清空选择",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
          {
            propertyName: "expandAll",
            label: "默认展开",
            helpText: "默认展开所有层级的选项",
            controlType: "SWITCH",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.BOOLEAN },
          },
        ],
      },
      {
        sectionName: "事件",
        children: [
          {
            helpText: "用户选中一个选项时触发",
            propertyName: "onOptionChange",
            label: "onOptionChange",
            controlType: "ACTION_SELECTOR",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: true,
          },
          {
            helpText: "when the dropdown opens",
            propertyName: "onDropdownOpen",
            label: "onDropdownOpen",
            controlType: "ACTION_SELECTOR",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: true,
          },
          {
            helpText: "when the dropdown closes",
            propertyName: "onDropdownClose",
            label: "onDropdownClose",
            controlType: "ACTION_SELECTOR",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: true,
          },
        ],
      },
    ];
  }

  static getStylesheetConfig(): Stylesheet {
    return {
      accentColor: "{{appsmith.theme.colors.primaryColor}}",
      borderRadius: "{{appsmith.theme.borderRadius.appBorderRadius}}",
      boxShadow: "none",
    };
  }

  static getPropertyPaneStyleConfig() {
    return [
      {
        sectionName: "标签样式",
        children: [
          {
            propertyName: "labelTextColor",
            label: "字体颜色",
            helpText: "设置标签字体颜色",
            controlType: "COLOR_PICKER",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            propertyName: "labelTextSize",
            label: "字体大小",
            helpText: "设置标签字体大小",
            controlType: "DROP_DOWN",
            defaultValue: "0.875rem",
            hidden: isAutoLayout,
            options: [
              {
                label: "S",
                value: "0.875rem",
                subText: "0.875rem",
              },
              {
                label: "M",
                value: "1rem",
                subText: "1rem",
              },
              {
                label: "L",
                value: "1.25rem",
                subText: "1.25rem",
              },
              {
                label: "XL",
                value: "1.875rem",
                subText: "1.875rem",
              },
              {
                label: "XXL",
                value: "3rem",
                subText: "3rem",
              },
              {
                label: "3XL",
                value: "3.75rem",
                subText: "3.75rem",
              },
            ],
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            propertyName: "labelStyle",
            label: "强调",
            helpText: "设置标签字体是否加粗或斜体",
            controlType: "BUTTON_GROUP",
            options: [
              {
                icon: "BOLD_FONT",
                value: "BOLD",
              },
              {
                icon: "ITALICS_FONT",
                value: "ITALIC",
              },
            ],
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
        ],
      },
      {
        sectionName: "轮廓样式",
        children: [
          {
            propertyName: "accentColor",
            label: "强调色",
            controlType: "COLOR_PICKER",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
            invisible: true,
          },
          {
            propertyName: "borderRadius",
            label: "边框圆角",
            helpText: "边框圆角样式",
            controlType: "BORDER_RADIUS_OPTIONS",

            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
          {
            propertyName: "boxShadow",
            label: "阴影",
            helpText: "组件轮廓投影",
            controlType: "BOX_SHADOW_OPTIONS",
            isJSConvertible: true,
            isBindProperty: true,
            isTriggerProperty: false,
            validation: { type: ValidationTypes.TEXT },
          },
        ],
      },
    ];
  }

  static getAutocompleteDefinitions(): AutocompletionDefinitions {
    return {
      "!doc":
        "TreeSelect is used to capture user input from a specified list of permitted inputs/Nested Inputs.",
      "!url": "https://docs.appsmith.com/widget-reference/treeselect",
      isVisible: DefaultAutocompleteDefinitions.isVisible,
      selectedOptionValue: {
        "!type": "string",
        "!doc": "The value selected in a treeselect dropdown",
        "!url": "https://docs.appsmith.com/widget-reference/treeselect",
      },
      selectedOptionLabel: {
        "!type": "string",
        "!doc": "The selected option label in a treeselect dropdown",
        "!url": "https://docs.appsmith.com/widget-reference/treeselect",
      },
      isDisabled: "bool",
      isValid: "bool",
      options: "[$__dropdownOption__$]",
    };
  }

  static getDerivedPropertiesMap() {
    return {
      value: `{{this.selectedOptionValue}}`,
      flattenedOptions: `{{(()=>{${derivedProperties.getFlattenedOptions}})()}}`,
      isValid: `{{(()=>{${derivedProperties.getIsValid}})()}}`,
      selectedOptionValue: `{{(()=>{${derivedProperties.getSelectedOptionValue}})()}}`,
      selectedOptionLabel: `{{(()=>{${derivedProperties.getSelectedOptionLabel}})()}}`,
    };
  }

  static getDefaultPropertiesMap(): Record<string, string> {
    return {
      selectedOption: "defaultOptionValue",
      selectedLabel: "defaultOptionValue",
    };
  }

  static getMetaPropertiesMap(): Record<string, any> {
    return {
      selectedOption: undefined,
      selectedLabel: undefined,
      isDirty: false,
    };
  }

  componentDidUpdate(prevProps: SingleSelectTreeWidgetProps): void {
    if (
      this.props.defaultOptionValue !== prevProps.defaultOptionValue &&
      this.props.isDirty
    ) {
      this.props.updateWidgetMetaProperty("isDirty", false);
    }
  }

  getPageView() {
    const options = isArray(this.props.options) ? this.props.options : [];
    const isInvalid =
      "isValid" in this.props && !this.props.isValid && !!this.props.isDirty;
    const dropDownWidth = MinimumPopupRows * this.props.parentColumnSpace;
    const { componentWidth } = this.getComponentDimensions();
    return (
      <SingleSelectTreeComponent
        accentColor={this.props.accentColor}
        allowClear={this.props.allowClear}
        borderRadius={this.props.borderRadius}
        boxShadow={this.props.boxShadow}
        compactMode={
          !(
            (this.props.bottomRow - this.props.topRow) /
              GRID_DENSITY_MIGRATION_V1 >
            1
          )
        }
        disabled={this.props.isDisabled ?? false}
        dropDownWidth={dropDownWidth}
        dropdownStyle={{
          zIndex: Layers.dropdownModalWidget,
        }}
        expandAll={this.props.expandAll}
        isDynamicHeightEnabled={isAutoHeightEnabledForWidget(this.props)}
        isFilterable
        isValid={!isInvalid}
        labelAlignment={this.props.labelAlignment}
        labelPosition={this.props.labelPosition}
        labelStyle={this.props.labelStyle}
        labelText={this.props.labelText}
        labelTextColor={this.props.labelTextColor}
        labelTextSize={this.props.labelTextSize}
        labelTooltip={this.props.labelTooltip}
        labelWidth={this.getLabelWidth()}
        loading={this.props.isLoading}
        onChange={this.onOptionChange}
        onDropdownClose={this.onDropdownClose}
        onDropdownOpen={this.onDropdownOpen}
        options={options}
        placeholder={this.props.placeholderText as string}
        renderMode={this.props.renderMode}
        value={this.props.selectedOptionValue}
        widgetId={this.props.widgetId}
        width={componentWidth}
      />
    );
  }

  onOptionChange = (value?: DefaultValueType, labelList?: ReactNode[]) => {
    if (!this.props.isDirty) {
      this.props.updateWidgetMetaProperty("isDirty", true);
    }

    this.props.updateWidgetMetaProperty("selectedOption", value);
    this.props.updateWidgetMetaProperty("selectedLabel", labelList?.[0] ?? "", {
      triggerPropertyName: "onOptionChange",
      dynamicString: this.props.onOptionChange,
      event: {
        type: EventType.ON_OPTION_CHANGE,
      },
    });
  };

  onDropdownOpen = () => {
    if (this.props.onDropdownOpen) {
      super.executeAction({
        triggerPropertyName: "onDropdownOpen",
        dynamicString: this.props.onDropdownOpen,
        event: {
          type: EventType.ON_DROPDOWN_OPEN,
        },
      });
    }
  };

  onDropdownClose = () => {
    if (this.props.onDropdownClose) {
      super.executeAction({
        triggerPropertyName: "onDropdownClose",
        dynamicString: this.props.onDropdownClose,
        event: {
          type: EventType.ON_DROPDOWN_CLOSE,
        },
      });
    }
  };

  static getWidgetType(): WidgetType {
    return "SINGLE_SELECT_TREE_WIDGET";
  }
}

export interface DropdownOption {
  label: string;
  value: string | number;
  disabled?: boolean;
  children?: DropdownOption[];
}

export interface SingleSelectTreeWidgetProps extends WidgetProps {
  placeholderText?: string;
  selectedIndex?: number;
  options?: DropdownOption[];
  flattenedOptions?: DropdownOption[];
  onOptionChange: string;
  onDropdownOpen?: string;
  onDropdownClose?: string;
  defaultOptionValue: string;
  isRequired: boolean;
  isLoading: boolean;
  allowClear: boolean;
  selectedLabel: string[];
  selectedOption: string | number;
  selectedOptionValue: string;
  selectedOptionLabel: string;
  expandAll: boolean;
  labelText: string;
  labelPosition?: LabelPosition;
  labelAlignment?: Alignment;
  labelWidth?: number;
  labelTextColor?: string;
  labelTextSize?: TextSize;
  labelStyle?: string;
  borderRadius: string;
  boxShadow?: string;
  accentColor: string;
  isDirty?: boolean;
}

export default SingleSelectTreeWidget;

```



# 网络

## 域名对应的ip

想知道域名映射的ip

ping一下，

比如

```
ping docs.pageplug.cn
```

输出结果就可以看到了

## 代理

执行 netstat 可以显示本地地址和端口、外部地址和端口、协议、状态：

```
C:\Users\86131>netstat

活动连接


  协议  本地地址          外部地址        状态
  TCP    127.0.0.1:49956        dev:49957              ESTABLISHED
  TCP    127.0.0.1:49957        dev:49956              ESTABLISHED
  TCP    192.168.110.198:54126  113.219.178.241:https  CLOSE_WAIT
  TCP    192.168.110.198:62264  203.119.145.218:https  ESTABLISHED
  TCP    192.168.110.198:62271  20.198.162.76:https    ESTABLISHED
  TCP    192.168.110.198:62314  183.60.15.170:https    ESTABLISHED
  TCP    192.168.110.198:63694  203.107.1.1:http       CLOSE_WAIT
  TCP    192.168.110.198:63695  123.182.51.64:https    CLOSE_WAIT
  TCP    192.168.110.198:64726  49.79.227.161:https    TIME_WAIT
  TCP    192.168.110.198:64729  182.247.225.49:https   ESTABLISHED
  TCP    192.168.110.198:64731  183.47.103.43:36688    TIME_WAIT
  TCP    192.168.110.198:64732  202.89.233.96:https    TIME_WAIT
  TCP    192.168.110.198:64734  144.123.124.3:https    TIME_WAIT
  TCP    192.168.110.198:64735  144.123.124.3:https    TIME_WAIT
  TCP    192.168.110.198:64736  144.123.124.3:https    TIME_WAIT
  TCP    192.168.110.198:64737  144.123.124.3:https    TIME_WAIT
  TCP    192.168.110.198:64738  144.123.124.3:https    TIME_WAIT
  TCP    192.168.110.198:64739  14.116.192.195:44001   ESTABLISHED
  TCP    192.168.110.198:64743  14.116.192.195:44001   ESTABLISHED
  TCP    192.168.110.198:64744  183.60.15.198:https    TIME_WAIT
  TCP    192.168.110.198:64745  180.163.210.217:8081   TIME_WAIT
```

# React

## React.createRef()

## useImperativeHandle()

## style-component

```tsx
export const TreeSelectContainer = styled.div<{
  allowClear?: boolean;
  compactMode: boolean;
  isValid: boolean;
  labelPosition?: LabelPosition;
  borderRadius: string;
  boxShadow?: string;
  accentColor: string;
}>`

样式规则
`
```

`styled` 函数接受一个参数，该参数是一个对象字面量，用于定义组件的样式规则；

上述几个变量是可以在css使用的props；

以下是一个示例，展示如何使用这个样式化的组件：

```tsx
import React from 'react';
import { TreeSelectContainer } from './TreeSelectContainer';

const MyComponent = () => {
  return (
    <TreeSelectContainer
      allowClear={true}
      compactMode={false}
      isValid={true}
      labelPosition="left"
      borderRadius="4px"
      boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"
      accentColor="#ff0000"
    >
      {/* 组件的内容 */}
    </TreeSelectContainer>
  );
};

export default MyComponent;
```



# TS

```tsx
class SingleSelectTreeWidget extends BaseWidget<
SingleSelectTreeWidgetProps,
WidgetState>
```

这段代码是 TypeScript 中的类定义，它定义了一个名为 `SingleSelectTreeWidget` 的类，该类继承自 `BaseWidget` 并接受两个**泛型参数：**`SingleSelectTreeWidgetProps` 和 `WidgetState`;

- `BaseWidget`：这是 `SingleSelectTreeWidget` 类的父类或基类，通过 `extends` 关键字将其作为父类进行继承。继承允许子类继承父类的属性和方法，并且可以在子类中添加自己的属性和方法，或者覆盖父类的属性和方法。
- `SingleSelectTreeWidgetProps`：这是一个泛型参数，用于指定 `SingleSelectTreeWidget` 类接受的属性的类型。泛型参数允许在类或函数**定义中**使用**不具体**指定类型的占位符，以便在实际**使用时**指定**具体**类型。
- `WidgetState`：这是另一个泛型参数，用于指定 `SingleSelectTreeWidget` 类的状态的类型。状态通常用于存储组件内部的数据，并在组件渲染和交互过程中进行管理和更新。

通过使用泛型参数，`SingleSelectTreeWidget` 类可以在实例化时指定具体的属性和状态类型，以符合特定的需求和使用场景。这样可以增加代码的可复用性和类型安全性，同时提供更好的开发和维护体验。

**举例**

```ts
class Container<T> {
  private value: T;

  constructor(initialValue: T) {
    this.value = initialValue;
  }

  getValue(): T {
    return this.value;
  }

  setValue(newValue: T): void {
    this.value = newValue;
  }
}
```

- `Container` 类有一个私有属性 `value`，其类型是泛型参数 `T`。这意味着 `value` 可以是任意类型，具体的类型由在实例化时传入的参数决定。
- 构造函数 `constructor` 接受一个初始值 `initialValue`，类型为 `T`，并将其赋值给 `value` 属性。
- `getValue` 方法返回 `value` 属性的值，类型为 `T`。
- `setValue` 方法接受一个新值 `newValue`，类型为 `T`，并将 `value` 属性更新为新值。

```ts
const numberContainer = new Container<number>(10);
console.log(numberContainer.getValue()); // 输出：10
numberContainer.setValue(20);
console.log(numberContainer.getValue()); // 输出：20

const stringContainer = new Container<string>("Hello");
console.log(stringContainer.getValue()); // 输出：Hello
stringContainer.setValue("World");
console.log(stringContainer.getValue()); // 输出：World
```

在这个示例中，我们首先创建了一个 `Container` 实例 `numberContainer`，并指定泛型参数为 `number`。然后，我们使用 `getValue` 方法打印出初始值。接着，我们使用 `setValue` 方法将值更新为 20，并再次打印出新值。

类似地，我们还创建了一个 `Container` 实例 `stringContainer`，并指定泛型参数为 `string`，然后进行相应的操作。

```ts
export interface TreeSelectProps
extends Required<
Pick<
SelectProps,
"disabled" | "placeholder" | "loading" | "dropdownStyle" | "allowClear"
>
```

- `Required<T>` 是 TypeScript 中的类型操作符，用于将接口或类型 `T` 中的所有属性标记为必需属性，即不能为 `undefined` 或 `null`。
- `Pick<SelectProps, "disabled" | "placeholder" | "loading" | "dropdownStyle" | "allowClear">` 表示从 `SelectProps` 接口中选择特定的属性，形成一个新的类型。在这里，我们选择了 `"disabled"`、`"placeholder"`、`"loading"`、`"dropdownStyle"` 和 `"allowClear"` 这些属性。

# Redux

```ts
[ReduxActionTypes.SAVE_ADMIN_SETTINGS]: (state: SettingsReduxState) => ({
    ...state,
    isSaving: true,
  })
```

**对象字面量**中，`[ReduxActionTypes.SAVE_ADMIN_SETTINGS]` 是一个**属性**名，它是一个Redux的动作类型（action type）。这个属性名使用了方括号括起来的写法，这是一种动态地使用变量或表达式作为属性名的方式。

## **如何确定函数调用顺序？**

- debugger
- 性能分析器
- 调用栈

## Redux Saga

# 业务

## 上传文件

前端负责文件选择、验证和发送请求，后端负责接收、验证和处理文件。

**前端：**

```html
<!DOCTYPE html>
<html>

<head>
  <title>文件上传示例</title>
</head>

<body>
  <h1>文件上传</h1>
  <form id="uploadForm" enctype="multipart/form-data">
    <input type="file" id="fileInput" name="file" />
    <button type="submit">上传</button>
  </form>

  <script>
    const form = document.getElementById('uploadForm');
    const fileInput = document.getElementById('fileInput');

    form.addEventListener('submit', (e) => {
      e.preventDefault(); // 阻止表单默认提交行为

      const files = fileInput.files;
      if (files.length === 0) {
        alert('请选择要上传的文件！');
        return;
      }

      const file = files[0];
      const formData = new FormData();
      formData.append('file', file);

      // 发送文件上传请求到服务器
      const xhr = new XMLHttpRequest();
      xhr.open('POST', 'http://localhost:8000/upload', true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          // 文件上传成功
          alert('文件上传成功！');
        } else if (xhr.readyState === 4 && xhr.status !== 200) {
          // 文件上传失败
          alert('文件上传失败！');
        }
      };
      xhr.send(formData);
    });
  </script>
</body>

</html>

```

**后端：**

```js
const express = require('express');
const multer = require('multer');

const app = express();
const upload = multer({ dest: 'uploads/' }); // 指定上传文件的存储目录

// 添加允许跨域请求的响应头
app.use((req, res, next) => {
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');
  next();
});

// 处理单个文件上传的路由
app.post('/upload', upload.single('file'), (req, res) => {
  if (!req.file) {
    return res.status(400).send('No file uploaded.');
  }

  // 文件上传成功，可以在这里对文件进行进一步处理或保存到数据库
  res.send('File uploaded!');
});

// 启动服务器
app.listen(8000, () => {
  console.log('Server is running on port 8000');
});

```

# react问题

## Objects are not valid as a React child

Uncaught Error: Objects are not valid as a React child (found: object with keys {}). If you meant to render a collection of children, use an array instead.

这个错误通常发生在使用 React 进行渲染时，尝试将一个对象作为 React 子元素进行渲染，而不是有效的 React 元素或组件。

以下是一个导致该错误的示例：

```js
const data = {
  name: 'John',
  age: 30,
};

function App() {
  return (
    <div>
      {data} {/* 错误的用法 */}
    </div>
  );
}
```

为了解决这个问题，你需要将对象转换为有效的 React 元素或组件，或者将对象中的特定属性提取出来进行渲染。以下是两个修正的示例：

将对象转换为字符串进行渲染：

```js
const data = {
  name: 'John',
  age: 30,
};

function App() {
  return (
    <div>
      {JSON.stringify(data)} {/* 将对象转换为字符串进行渲染 */}
    </div>
  );
}
```

提取对象属性进行渲染：

```js
const data = {
  name: 'John',
  age: 30,
};

function App() {
  return (
    <div>
      <p>Name: {data.name}</p>
      <p>Age: {data.age}</p>
    </div>
  );
}
```

## Warning: validateDOMNesting(...): <div> cannot appear as a descendant of <p>.

这个警告是由 React 提供的 DOM 结构验证机制触发的。它表示在 HTML 中，`<div>` 元素不能作为 `<p>` 元素的子元素出现。

以下是一个示例，展示了触发该警告的情况：

```html
<p>
  这是一个段落。
  <div>这是一个 div。</div>
</p>
```

以下是一个修改后的示例，修复了这个警告：

```html
<div>
  <p>这是一个段落。</p>
  <div>这是一个 div。</div>
</div>
```

# git

## 切换remote

```
git remote set-url origin <new-url>
```

## 查看配置

```bash
查看全局配置信息：
git config --global --list
这将显示全局配置的所有信息，包括用户名、电子邮件、默认编辑器等。

查看当前仓库的配置信息：
git config --list
在仓库目录下执行此命令，将显示当前仓库的配置信息。

查看特定配置项的值：
git config <key>
将 <key> 替换为要查看的特定配置项的名称，例如：
git config user.name
git config core.editor
查看 Git 的所有配置信息：

git config --list --show-origin
此命令将显示所有 Git 配置项及其来源（配置文件和命令行选项等）。
```



# 建站工具

## docsaurus+algolia搜索引擎

1. 首先，确保你已经在 Algolia 上创建了一个帐户并设置了一个新的搜索索引。获得 Algolia 的 Application ID 和 Search-Only API Key。

2. 在你的 Docusaurus 项目中，安装 `@docusaurus/plugin-search-algolia` 插件。运行以下命令：

   shell

   Copy

   ```
   npm install @docusaurus/plugin-search-algolia
   ```

3. 打开 `docusaurus.config.js` 文件，并添加以下配置：

   javascript

   Copy

   ```
   module.exports = {
     // ...
     plugins: [
       [
         '@docusaurus/plugin-search-algolia',
         {
           apiKey: 'YOUR_API_KEY',
           indexName: 'YOUR_INDEX_NAME',
           // Optional: 搜索结果页面的路径，默认为 '/search'
           // searchResultPagePath: '/search',
           // Optional: 定制 Algolia 搜索配置
           // algoliaOptions: {},
         },
       ],
     ],
     // ...
   };
   ```

   在上述配置中，将 `'YOUR_API_KEY'` 替换为你的 Algolia Search-Only API Key，将 `'YOUR_INDEX_NAME'` 替换为你的搜索索引名称。

4. 保存并关闭 `docusaurus.config.js` 文件。

5. 运行 Docusaurus 以构建和启动你的文档网站：

   shell

   Copy

   ```
   npm run start
   ```

   Algolia 插件将会在构建过程中执行索引生成操作，并将索引上传到 Algolia 服务器。

6. 在你的 Docusaurus 网站上，你可以通过在导航栏或其他适当的位置添加搜索框来启用搜索功能。示例代码如下：

   jsx

   Copy

   ```
   import React from 'react';
   import { useDocsSearch } from '@docusaurus/theme-common';
   
   const SearchBar = () => {
     const { isOpen, openSearchBar, closeSearchBar } = useDocsSearch();
   
     return (
       <div>
         {isOpen ? (
           <input type="text" placeholder="Search" onBlur={closeSearchBar} autoFocus />
         ) : (
           <button onClick={openSearchBar}>Search</button>
         )}
       </div>
     );
   };
   
   export default SearchBar;
   ```

全文搜索步骤：

1.申请Algolia DocSearch服务

2.回复确认邮件

```
Thanks!

I am the maintatiner of the website, I can modify the code.
```

3.启动搜索服务

4.后台管理数据

# 原理了解

## algolia搜索插件原理



# 问题&解决方案

## @sentry/cli

执行yarn，link步骤出现 `@sentry/cli@npm:1.75.2 couldn't be built successfully (exit code 1, logs can be found here: D:\temp\xfs-0d7a820d\build.log)`

```
[sentry-cli] Downloading from https://downloads.sentry-cdn.com/sentry-cli/1.75.2/sentry-cli-Windows-x86_64.exe
Error: Unable to download sentry-cli binary from https://downloads.sentry-cdn.com/sentry-cli/1.75.2/sentry-cli-Windows-x86_64.exe.
Error code: ECONNRESET
```

**解决**：

发现是**@sentry/webpack-plugin**依赖了**@sentry/cli**

1.根目录下新建.yarnrc

```
npmRegistryServer: "http://registry.npm.taobao.org/"
strict-ssl: false
```

单独安装@sentry/webpack-plugin

```
yarn add @sentry/webpack-plugin@1.18.9
```

## msys-crypto-1.1.dll

执行bash ./build.sh -DskipTests

日志有这条信息：D:/devTools/git/Git/usr/bin/rsync.exe: error while loading shared libraries: msys-crypto-1.1.dll: **cannot open shared object file**: No such file or directory

找到这个文件，放到**D:/devTools/git/Git/usr/bin**下就好了



## playwright安装慢

执行yarn，link 步骤第三方库playwright安装慢

